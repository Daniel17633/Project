-- Таблица Restaurants
CREATE TABLE Restaurants (
    restaurant_id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    address TEXT,
    phone TEXT,
    email TEXT
);

-- Таблица Customers
CREATE TABLE Customers (
    customer_id SERIAL PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT,
    phone TEXT,
    address TEXT
);

-- Таблица Suppliers
CREATE TABLE Suppliers (
    supplier_id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    contact_email TEXT,
    phone TEXT
);

-- Таблица Ingredients
CREATE TABLE Ingredients (
    ingredient_id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    unit TEXT,
    supplier_id INTEGER,
    FOREIGN KEY (supplier_id) REFERENCES Suppliers(supplier_id)
);

-- Таблица Chefs
CREATE TABLE Chefs (
    chef_id SERIAL PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    specialization TEXT,
    restaurant_id INTEGER,
    FOREIGN KEY (restaurant_id) REFERENCES Restaurants(restaurant_id)
);

-- Таблица Dishes
CREATE TABLE Dishes (
    dish_id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    price REAL,
    restaurant_id INTEGER,
    FOREIGN KEY (restaurant_id) REFERENCES Restaurants(restaurant_id)
);

-- Таблица Tables
CREATE TABLE Tables (
    table_id SERIAL PRIMARY KEY,
    table_number INTEGER NOT NULL,
    capacity INTEGER,
    restaurant_id INTEGER,
    FOREIGN KEY (restaurant_id) REFERENCES Restaurants(restaurant_id)
);

-- Таблица Orders
CREATE TABLE Orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    restaurant_id INTEGER,
    table_id INTEGER,
    order_date TIMESTAMP,  -- Используем TIMESTAMP для дат с временем
    total_price REAL,
    status TEXT CHECK (status IN ('pending', 'confirmed', 'preparing', 'ready', 'delivered', 'cancelled')),
    order_type TEXT CHECK (order_type IN ('dine-in', 'takeaway', 'delivery')),
    FOREIGN KEY (customer_id) REFERENCES Customers(customer_id),
    FOREIGN KEY (restaurant_id) REFERENCES Restaurants(restaurant_id),
    FOREIGN KEY (table_id) REFERENCES Tables(table_id)
);

-- Таблица Reviews
CREATE TABLE Reviews (
    review_id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    order_id INTEGER UNIQUE,  -- 1:1 с Orders
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    comment TEXT,
    date_posted DATE,  -- Используем DATE для простоты (без времени)
    FOREIGN KEY (customer_id) REFERENCES Customers(customer_id),
    FOREIGN KEY (order_id) REFERENCES Orders(order_id)
);

-- Таблица OrderItems (для N:N между Orders и Dishes)
CREATE TABLE OrderItems (
    order_item_id SERIAL PRIMARY KEY,
    order_id INTEGER,
    dish_id INTEGER,
    quantity INTEGER,
    FOREIGN KEY (order_id) REFERENCES Orders(order_id),
    FOREIGN KEY (dish_id) REFERENCES Dishes(dish_id)
);

-- Таблица DishIngredients (для N:N между Dishes и Ingredients)
CREATE TABLE DishIngredients (
    dish_ingredient_id SERIAL PRIMARY KEY,
    dish_id INTEGER,
    ingredient_id INTEGER,
    quantity REAL,
    FOREIGN KEY (dish_id) REFERENCES Dishes(dish_id),
    FOREIGN KEY (ingredient_id) REFERENCES Ingredients(ingredient_id)
);
